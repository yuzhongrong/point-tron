# 快速开始

<cite>
**本文档引用的文件**
- [README.md](file://README.md)
- [package.json](file://package.json)
- [src/index.ts](file://src/index.ts)
- [src/config/index.ts](file://src/config/index.ts)
- [src/database/index.ts](file://src/database/index.ts)
- [src/services/TronRPCService.ts](file://src/services/TronRPCService.ts)
- [src/services/BlockDataService.ts](file://src/services/BlockDataService.ts)
- [src/routes/auth.ts](file://src/routes/auth.ts)
- [src/routes/blocks.ts](file://src/routes/blocks.ts)
</cite>

## 目录
1. [项目简介](#项目简介)
2. [环境要求](#环境要求)
3. [项目安装](#项目安装)
4. [配置设置](#配置设置)
5. [系统启动](#系统启动)
6. [访问系统](#访问系统)
7. [功能概述](#功能概述)
8. [故障排除](#故障排除)
9. [开发指南](#开发指南)

## 项目简介

Point-Tron 是一个基于 TypeScript 和 Node.js 开发的波场网络区块链数据统计后台管理系统。该系统实时监控波场网络每 3 秒的出块情况，统计区块哈希最后一个阿拉伯数字的单双数规律，并提供可视化的数据分析界面。

### 核心功能

- **实时数据采集**：每 3 秒自动获取 TRON 网络最新区块数据
- **智能数据解析**：自动提取区块哈希最后数字并判断单双数
- **统计分析**：提供今日、历史数据统计和趋势分析
- **后台管理**：现代化的 Web 管理界面
- **安全认证**：JWT 令牌认证和用户权限管理
- **错误处理**：完善的错误重试和异常处理机制

## 环境要求

在开始部署之前，请确保您的系统满足以下最低要求：

### Node.js 版本要求
- **Node.js**: ≥ 16.0.0
- **npm**: ≥ 8.0.0

### 系统要求
- **操作系统**: Windows 10+, macOS 10.15+, 或 Linux (Ubuntu 18.04+)
- **内存**: 至少 512MB RAM
- **存储空间**: 至少 100MB 可用磁盘空间
- **网络**: 稳定的互联网连接

### 检查环境版本

在终端中运行以下命令检查版本：

```bash
node --version
npm --version
```

如果版本低于要求，请前往 [Node.js官网](https://nodejs.org/) 下载并安装最新稳定版本。

## 项目安装

### 步骤 1：克隆项目

首先，将项目克隆到本地：

```bash
git clone https://github.com/your-repository/point-tron.git
cd point-tron
```

### 步骤 2：安装依赖包

使用 npm 安装项目所需的所有依赖：

```bash
npm install
```

安装过程完成后，您应该看到类似以下的输出：

```
added 123 packages from 234 contributors and audited 123 packages in XX.XXs
found 0 vulnerabilities
```

### 依赖包说明

项目的主要依赖包括：

- **核心框架**: Express.js (Web 服务器框架)
- **数据库**: SQLite (轻量级关系型数据库)
- **认证**: JWT (JSON Web Token)
- **区块链**: TRON RPC API (波场网络接口)
- **模板引擎**: EJS (HTML 模板渲染)
- **安全**: Helmet (HTTP 头保护)
- **工具**: TypeScript (类型安全的 JavaScript)

**章节来源**
- [package.json](file://package.json#L1-L39)

## 配置设置

### 环境变量配置

项目使用 `.env` 文件进行配置管理。请按照以下步骤设置配置：

#### 1. 复制配置文件

```bash
cp .env.example .env
```

#### 2. 编辑配置文件

打开 `.env` 文件并根据需要修改以下配置项：

```bash
# 服务器配置
PORT=3000
NODE_ENV=development

# 数据库配置
DB_PATH=./data/point-tron.db

# JWT 配置
JWT_SECRET=your-super-secret-jwt-key-change-in-production
JWT_EXPIRES_IN=7d

# TRON 网络配置
TRON_RPC_URL=https://api.trongrid.io
TRON_TIMEOUT=5000
TRON_RETRY_TIMES=3
TRON_POLLING_INTERVAL=3000

# 默认管理员账户
DEFAULT_ADMIN_USERNAME=admin
DEFAULT_ADMIN_PASSWORD=admin123
```

#### 3. 配置说明

| 配置项 | 默认值 | 说明 |
|--------|--------|------|
| PORT | 3000 | 服务器监听端口 |
| NODE_ENV | development | 运行环境 (development/prodction) |
| DB_PATH | ./data/point-tron.db | SQLite 数据库文件路径 |
| JWT_SECRET | your-super-secret-jwt-key-change-in-production | JWT 令牌密钥 |
| JWT_EXPIRES_IN | 7d | JWT 令牌有效期 |
| TRON_RPC_URL | https://api.trongrid.io | TRON RPC 节点地址 |
| TRON_TIMEOUT | 5000 | RPC 请求超时时间（毫秒） |
| TRON_RETRY_TIMES | 3 | RPC 请求重试次数 |
| TRON_POLLING_INTERVAL | 3000 | 区块轮询间隔（毫秒） |
| DEFAULT_ADMIN_USERNAME | admin | 默认管理员用户名 |
| DEFAULT_ADMIN_PASSWORD | admin123 | 默认管理员密码 |

### 数据库配置

系统使用 SQLite 作为默认数据库。配置中的 `DB_PATH` 指定了数据库文件的位置：

- **开发环境**: `./data/point-tron.db`
- **生产环境**: 建议使用绝对路径以避免权限问题

**章节来源**
- [src/config/index.ts](file://src/config/index.ts#L1-L52)

## 系统启动

### 编译 TypeScript 代码

在启动之前，需要将 TypeScript 代码编译为 JavaScript：

```bash
npm run build
```

编译过程会：
1. 将 `src/` 目录下的 TypeScript 文件编译为 JavaScript
2. 复制 EJS 模板文件到 `dist/views/` 目录
3. 生成 `dist/` 目录作为最终输出

### 启动选项

项目提供了多种启动方式：

#### 1. 生产模式启动

```bash
npm start
```

此命令直接运行编译后的 JavaScript 代码，适合生产环境。

#### 2. 开发模式启动（推荐）

```bash
npm run dev
```

开发模式具有以下优势：
- 自动重启：代码变更时自动重新编译和重启
- 错误提示：更详细的错误堆栈信息
- 调试支持：更好的调试体验

### 启动日志

成功启动后，您会看到如下日志信息：

```
🚀 Point-Tron服务器启动成功
📡 服务地址: http://localhost:3000
🔗 TRON网络: https://api.trongrid.io
⏰ 轮询间隔: 3000ms
📊 后台管理: http://localhost:3000/admin
```

同时，系统会自动创建默认管理员账户：

```
✅ 默认管理员账户已创建: admin
```

**章节来源**
- [src/index.ts](file://src/index.ts#L1-L163)

## 访问系统

### 登录地址

- **主页面**: http://localhost:3000
- **登录页面**: http://localhost:3000/login
- **管理后台**: http://localhost:3000/admin
- **健康检查**: http://localhost:3000/health

### 默认登录凭据

系统预设了默认管理员账户：

- **用户名**: admin
- **密码**: admin123

首次登录后，建议立即修改默认密码以提高安全性。

### 功能页面导航

系统提供以下主要功能页面：

1. **仪表盘**: 实时区块统计和趋势概览
2. **区块详情**: 详细的区块数据查询
3. **历史统计**: 历史数据和趋势分析
4. **系统设置**: 系统配置和管理
5. **用户管理**: 用户账户和权限管理

## 功能概述

### 实时监控功能

系统每 3 秒自动从 TRON 网络获取最新区块，并实时统计：

- **区块总数**：按日统计总区块数量
- **单数区块**：哈希末位为 1,3,5,7,9 的区块
- **双数区块**：哈希末位为 0,2,4,6,8 的区块
- **单双数比例**：计算单双数区块的比例

### 数据展示功能

- **实时统计卡片**：显示今日区块统计信息
- **单双数分布饼图**：可视化单双数分布
- **24小时趋势图表**：展示最近24小时的区块趋势
- **区块详细信息表格**：列出最新的区块信息

### API 接口

系统提供完整的 RESTful API 接口：

#### 认证相关
```bash
# 用户登录
POST /api/auth/login
Content-Type: application/json
{
  "username": "admin",
  "password": "admin123"
}

# 验证令牌
POST /api/auth/verify
Authorization: Bearer {token}
```

#### 数据查询
```bash
# 获取实时统计
GET /api/blocks/stats
Authorization: Bearer {token}

# 获取历史数据
GET /api/blocks/history?date=2024-01-01
Authorization: Bearer {token}

# 获取系统状态
GET /api/system/status
Authorization: Bearer {token}
```

**章节来源**
- [src/routes/auth.ts](file://src/routes/auth.ts#L1-L62)
- [src/routes/blocks.ts](file://src/routes/blocks.ts#L1-L141)

## 故障排除

### 常见问题及解决方案

#### 1. 端口占用问题

**问题症状**：
```
Error: listen EADDRINUSE :::3000
```

**解决方法**：
```bash
# 方法1：修改端口配置
echo "PORT=3001" >> .env

# 方法2：查找并终止占用进程
# Linux/macOS
lsof -ti:3000 | xargs kill -9

# Windows
netstat -ano | findstr :3000
taskkill /PID <PID> /F
```

#### 2. 数据库连接失败

**问题症状**：
```
数据库连接失败: Error: SQLITE_CANTOPEN: unable to open database file
```

**解决方法**：
```bash
# 检查数据目录权限
mkdir -p ./data
chmod 755 ./data

# 检查数据库文件权限
chmod 644 ./data/point-tron.db
```

#### 3. TRON 网络连接超时

**问题症状**：
```
RPC轮询错误 (连续第3次): FetchError: request to https://api.trongrid.io/wallet/getnowblock failed
```

**解决方法**：
```bash
# 方法1：更换RPC节点
echo "TRON_RPC_URL=https://api.shasta.trongrid.io" >> .env

# 方法2：增加超时时间
echo "TRON_TIMEOUT=10000" >> .env

# 方法3：检查网络连接
ping api.trongrid.io
```

#### 4. 内存不足问题

**问题症状**：
```
JavaScript heap out of memory
```

**解决方法**：
```bash
# 增加Node.js内存限制
export NODE_OPTIONS="--max-old-space-size=2048"

# 或者在启动命令中指定
node --max-old-space-size=2048 dist/index.js
```

### 日志查看

系统运行时会输出详细的日志信息：

```bash
# 查看实时日志
npm run dev

# 查看启动日志
npm start
```

### 健康检查

使用健康检查接口验证系统状态：

```bash
curl http://localhost:3000/health
```

健康检查会返回：
- 服务状态
- 数据库连接状态
- RPC 轮询状态
- 系统运行时间

**章节来源**
- [src/index.ts](file://src/index.ts#L80-L120)

## 开发指南

### 项目结构

```
point-tron/
├── src/
│   ├── config/           # 配置管理
│   ├── database/         # 数据库连接和操作
│   ├── models/           # 数据模型
│   ├── services/         # 业务服务层
│   ├── routes/           # API 路由
│   ├── middleware/       # 中间件
│   ├── views/            # EJS 模板
│   └── index.ts          # 应用入口
├── public/               # 静态资源
├── data/                 # 数据库文件
├── dist/                 # 编译输出
└── package.json
```

### 新增功能流程

1. **添加路由**：在 `src/routes/` 中创建新的路由文件
2. **实现服务**：在 `src/services/` 中实现业务逻辑
3. **定义模型**：在 `src/models/` 中定义数据模型
4. **更新类型**：在 `src/models/types.ts` 中更新类型定义
5. **注册路由**：在 `src/index.ts` 中注册新的路由

### 代码规范

- **命名规范**：使用驼峰命名法
- **文件命名**：使用小写字母和连字符
- **注释规范**：为公共接口提供 JSDoc 注释
- **错误处理**：统一的错误处理和日志记录

### 测试运行

运行内置的测试脚本验证系统功能：

```bash
node test.js
```

测试内容包括：
- 系统健康检查
- 用户登录认证
- 区块数据获取
- 系统状态查询
- 配置信息获取

### 部署建议

对于生产环境部署，建议：

1. **环境配置**：设置 `NODE_ENV=production`
2. **安全配置**：更改默认的 JWT 密钥和管理员密码
3. **数据库备份**：定期备份 SQLite 数据库文件
4. **监控告警**：设置系统监控和告警机制
5. **负载均衡**：考虑使用反向代理和负载均衡

**章节来源**
- [README.md](file://README.md#L1-L290)