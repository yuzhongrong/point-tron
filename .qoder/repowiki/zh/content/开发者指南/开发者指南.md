# Point-Tron å¼€å‘è€…æŒ‡å—

<cite>
**æœ¬æ–‡æ¡£å¼•ç”¨çš„æ–‡ä»¶**
- [src/index.ts](file://src/index.ts)
- [src/config/index.ts](file://src/config/index.ts)
- [src/database/index.ts](file://src/database/index.ts)
- [src/routes/auth.ts](file://src/routes/auth.ts)
- [src/services/AuthService.ts](file://src/services/AuthService.ts)
- [src/models/UserModel.ts](file://src/models/UserModel.ts)
- [src/services/TronRPCService.ts](file://src/services/TronRPCService.ts)
- [src/services/BlockDataService.ts](file://src/services/BlockDataService.ts)
- [src/models/types.ts](file://src/models/types.ts)
- [src/routes/blocks.ts](file://src/routes/blocks.ts)
- [README.md](file://README.md)
</cite>

## ç›®å½•
1. [é¡¹ç›®æ¦‚è¿°](#é¡¹ç›®æ¦‚è¿°)
2. [åº”ç”¨å¯åŠ¨æµç¨‹](#åº”ç”¨å¯åŠ¨æµç¨‹)
3. [æ ¸å¿ƒæ¶æ„è®¾è®¡](#æ ¸å¿ƒæ¶æ„è®¾è®¡)
4. [æ–°å¢APIè·¯ç”±æŒ‡å—](#æ–°å¢apiè·¯ç”±æŒ‡å—)
5. [ä¸šåŠ¡é€»è¾‘æ‰©å±•](#ä¸šåŠ¡é€»è¾‘æ‰©å±•)
6. [æ•°æ®æ¨¡å‹è®¾è®¡](#æ•°æ®æ¨¡å‹è®¾è®¡)
7. [åŒºå—é“¾ç½‘ç»œæ‰©å±•](#åŒºå—é“¾ç½‘ç»œæ‰©å±•)
8. [ä»£ç è§„èŒƒä¸æœ€ä½³å®è·µ](#ä»£ç è§„èŒƒä¸æœ€ä½³å®è·µ)
9. [è°ƒè¯•ä¸æµ‹è¯•](#è°ƒè¯•ä¸æµ‹è¯•)
10. [æ•…éšœæ’é™¤æŒ‡å—](#æ•…éšœæ’é™¤æŒ‡å—)

## é¡¹ç›®æ¦‚è¿°

Point-Tron æ˜¯ä¸€ä¸ªåŸºäº TypeScript å’Œ Node.js å¼€å‘çš„æ³¢åœºç½‘ç»œåŒºå—é“¾æ•°æ®ç»Ÿè®¡åå°ç®¡ç†ç³»ç»Ÿã€‚è¯¥ç³»ç»Ÿå®æ—¶ç›‘æ§æ³¢åœºç½‘ç»œæ¯ 3 ç§’çš„å‡ºå—æƒ…å†µï¼Œç»Ÿè®¡åŒºå—å“ˆå¸Œæœ€åä¸€ä¸ªé˜¿æ‹‰ä¼¯æ•°å­—çš„å•åŒæ•°è§„å¾‹ï¼Œå¹¶æä¾›å¯è§†åŒ–çš„æ•°æ®åˆ†æç•Œé¢ã€‚

### æ ¸å¿ƒç‰¹æ€§

- **å®æ—¶æ•°æ®é‡‡é›†**ï¼šæ¯ 3 ç§’è‡ªåŠ¨è·å– TRON ç½‘ç»œæœ€æ–°åŒºå—æ•°æ®
- **æ™ºèƒ½æ•°æ®è§£æ**ï¼šè‡ªåŠ¨æå–åŒºå—å“ˆå¸Œæœ€åæ•°å­—å¹¶åˆ¤æ–­å•åŒæ•°
- **ç»Ÿè®¡åˆ†æ**ï¼šæä¾›ä»Šæ—¥ã€å†å²æ•°æ®ç»Ÿè®¡å’Œè¶‹åŠ¿åˆ†æ
- **å®‰å…¨è®¤è¯**ï¼šJWT ä»¤ç‰Œè®¤è¯å’Œç”¨æˆ·æƒé™ç®¡ç†
- **é”™è¯¯å¤„ç†**ï¼šå®Œå–„çš„é”™è¯¯é‡è¯•å’Œå¼‚å¸¸å¤„ç†æœºåˆ¶

**ç« èŠ‚æ¥æº**
- [README.md](file://README.md#L1-L50)

## åº”ç”¨å¯åŠ¨æµç¨‹

### å¯åŠ¨åºåˆ—å›¾

```mermaid
sequenceDiagram
participant Main as "ä¸»ç¨‹åº"
participant App as "Appç±»"
participant DB as "æ•°æ®åº“"
participant RPC as "TRON RPCæœåŠ¡"
participant BD as "åŒºå—æ•°æ®æœåŠ¡"
participant Server as "ExpressæœåŠ¡å™¨"
Main->>App : åˆ›å»ºAppå®ä¾‹
App->>App : åˆå§‹åŒ–ä¸­é—´ä»¶
App->>App : åˆå§‹åŒ–è·¯ç”±
App->>App : åˆå§‹åŒ–é”™è¯¯å¤„ç†
App->>DB : è¿æ¥æ•°æ®åº“
DB-->>App : è¿æ¥æˆåŠŸ
App->>DB : åˆå§‹åŒ–è¡¨ç»“æ„
DB-->>App : è¡¨ç»“æ„å°±ç»ª
App->>App : åˆ›å»ºé»˜è®¤ç®¡ç†å‘˜è´¦æˆ·
App->>RPC : å¯åŠ¨TRON RPCè½®è¯¢
RPC-->>App : è½®è¯¢å¯åŠ¨æˆåŠŸ
App->>BD : å¯åŠ¨åŒºå—æ•°æ®é‡‡é›†
BD-->>App : æœåŠ¡å¯åŠ¨æˆåŠŸ
App->>Server : å¯åŠ¨ExpressæœåŠ¡å™¨
Server-->>App : æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ
Note over Main,Server : åº”ç”¨å¯åŠ¨å®Œæˆ
```

**å›¾è¡¨æ¥æº**
- [src/index.ts](file://src/index.ts#L120-L163)

### ç»„ä»¶åˆå§‹åŒ–é¡ºåº

åº”ç”¨å¯åŠ¨éµå¾ªä¸¥æ ¼çš„åˆå§‹åŒ–é¡ºåºï¼Œç¡®ä¿å„ç»„ä»¶æŒ‰ä¾èµ–å…³ç³»æ­£ç¡®åŠ è½½ï¼š

1. **ä¸­é—´ä»¶åˆå§‹åŒ–**ï¼šå®‰å…¨ã€CORSã€é€Ÿç‡é™åˆ¶ç­‰ä¸­é—´ä»¶
2. **æ•°æ®åº“è¿æ¥**ï¼šå»ºç«‹SQLiteæ•°æ®åº“è¿æ¥
3. **è¡¨ç»“æ„åˆå§‹åŒ–**ï¼šåˆ›å»ºå¿…è¦çš„æ•°æ®åº“è¡¨
4. **é»˜è®¤ç”¨æˆ·åˆ›å»º**ï¼šåˆå§‹åŒ–ç®¡ç†å‘˜è´¦æˆ·
5. **TRON RPCæœåŠ¡å¯åŠ¨**ï¼šå¼€å§‹åŒºå—æ•°æ®è½®è¯¢
6. **åŒºå—æ•°æ®æœåŠ¡å¯åŠ¨**ï¼šå¤„ç†åŒºå—æ•°æ®é‡‡é›†
7. **ExpressæœåŠ¡å™¨å¯åŠ¨**ï¼šç›‘å¬HTTPè¯·æ±‚

**ç« èŠ‚æ¥æº**
- [src/index.ts](file://src/index.ts#L25-L120)

## æ ¸å¿ƒæ¶æ„è®¾è®¡

### ç³»ç»Ÿæ¶æ„å›¾

```mermaid
graph TB
subgraph "å®¢æˆ·ç«¯å±‚"
Browser[æµè§ˆå™¨]
Mobile[ç§»åŠ¨è®¾å¤‡]
end
subgraph "WebæœåŠ¡å™¨å±‚"
Express[Express.js]
Middleware[ä¸­é—´ä»¶]
Routes[è·¯ç”±å±‚]
end
subgraph "ä¸šåŠ¡é€»è¾‘å±‚"
AuthService[è®¤è¯æœåŠ¡]
BlockService[åŒºå—æœåŠ¡]
TronRPC[TRON RPCæœåŠ¡]
end
subgraph "æ•°æ®è®¿é—®å±‚"
UserModel[ç”¨æˆ·æ¨¡å‹]
BlockModel[åŒºå—æ¨¡å‹]
StatsModel[ç»Ÿè®¡æ¨¡å‹]
Database[SQLiteæ•°æ®åº“]
end
subgraph "å¤–éƒ¨æœåŠ¡"
TRON[TRONç½‘ç»œ]
end
Browser --> Express
Mobile --> Express
Express --> Middleware
Express --> Routes
Routes --> AuthService
Routes --> BlockService
BlockService --> TronRPC
AuthService --> UserModel
BlockService --> BlockModel
BlockService --> StatsModel
BlockModel --> Database
StatsModel --> Database
TronRPC --> TRON
```

**å›¾è¡¨æ¥æº**
- [src/index.ts](file://src/index.ts#L1-L25)
- [src/services/TronRPCService.ts](file://src/services/TronRPCService.ts#L1-L50)

### è®¾è®¡æ¨¡å¼åº”ç”¨

ç³»ç»Ÿé‡‡ç”¨äº†å¤šç§è®¾è®¡æ¨¡å¼æ¥æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œæ‰©å±•æ€§ï¼š

1. **å•ä¾‹æ¨¡å¼**ï¼šæ•°æ®åº“è¿æ¥é‡‡ç”¨å•ä¾‹æ¨¡å¼
2. **å·¥å‚æ¨¡å¼**ï¼šæœåŠ¡ç±»è´Ÿè´£åˆ›å»ºå’Œç®¡ç†å­ç»„ä»¶
3. **è§‚å¯Ÿè€…æ¨¡å¼**ï¼šTRON RPCè½®è¯¢ä½¿ç”¨å›è°ƒå‡½æ•°é€šçŸ¥æ•°æ®å˜åŒ–
4. **ç­–ç•¥æ¨¡å¼**ï¼šä¸åŒåŒºå—é“¾ç½‘ç»œå¯ä»¥é‡‡ç”¨ä¸åŒçš„æ•°æ®å¤„ç†ç­–ç•¥

**ç« èŠ‚æ¥æº**
- [src/database/index.ts](file://src/database/index.ts#L240-L249)
- [src/services/TronRPCService.ts](file://src/services/TronRPCService.ts#L30-L80)

## æ–°å¢APIè·¯ç”±æŒ‡å—

### æ ‡å‡†å¼€å‘æµç¨‹

æ–°å¢APIè·¯ç”±éœ€è¦éµå¾ªä»¥ä¸‹æ ‡å‡†æ­¥éª¤ï¼š

#### 1. åˆ›å»ºè·¯ç”±æ–‡ä»¶

åœ¨ `src/routes/` ç›®å½•ä¸‹åˆ›å»ºæ–°çš„è·¯ç”±æ–‡ä»¶ï¼Œä¾‹å¦‚ `custom.ts`ï¼š

```typescript
import express from 'express';
import { ApiResponse } from '../models/types';
import { authenticateToken } from '../middleware/auth';

const router = express.Router();

// ç¤ºä¾‹ï¼šè·å–è‡ªå®šä¹‰æ•°æ®
router.get('/custom-data', authenticateToken, async (req, res) => {
  try {
    // å®ç°ä¸šåŠ¡é€»è¾‘
    const data = await someService.getData();
    
    res.json({
      success: true,
      data: data
    });
    
  } catch (error) {
    res.status(500).json({
      success: false,
      error: 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯'
    });
  }
});

export default router;
```

#### 2. æ³¨å†Œè·¯ç”±åˆ°ä¸»åº”ç”¨

åœ¨ `src/index.ts` ä¸­å¯¼å…¥å¹¶æ³¨å†Œæ–°çš„è·¯ç”±ï¼š

```typescript
// å¯¼å…¥æ–°è·¯ç”±
import customRoutes from './routes/custom';

// åœ¨initializeRoutesæ–¹æ³•ä¸­æ³¨å†Œ
private initializeRoutes(): void {
  // ... å…¶ä»–è·¯ç”±
  
  // æ–°å¢è‡ªå®šä¹‰è·¯ç”±
  this.app.use('/api/custom', customRoutes);
}
```

#### 3. å®ç°ä¸šåŠ¡é€»è¾‘

åœ¨ `src/services/` ç›®å½•ä¸‹åˆ›å»ºå¯¹åº”çš„æœåŠ¡ç±»ï¼š

```typescript
export class CustomService {
  // å®ç°ä¸šåŠ¡é€»è¾‘æ–¹æ³•
  static async getData(): Promise<any> {
    // ä¸šåŠ¡é€»è¾‘å®ç°
  }
  
  // å…¶ä»–æ–¹æ³•...
}
```

#### 4. å®šä¹‰æ•°æ®æ¨¡å‹

åœ¨ `src/models/` ç›®å½•ä¸‹åˆ›å»ºæ•°æ®æ¨¡å‹ï¼š

```typescript
export interface CustomData {
  id?: number;
  name: string;
  value: number;
  timestamp: Date;
}
```

#### 5. æ›´æ–°ç±»å‹å®šä¹‰

åœ¨ `src/models/types.ts` ä¸­æ·»åŠ æ–°çš„æ¥å£å®šä¹‰ï¼š

```typescript
// æ–°å¢è‡ªå®šä¹‰æ•°æ®æ¥å£
export interface CustomData {
  id?: number;
  name: string;
  value: number;
  timestamp: Date;
}
```

### APIè®¾è®¡æœ€ä½³å®è·µ

1. **ç»Ÿä¸€å“åº”æ ¼å¼**ï¼šä½¿ç”¨ `ApiResponse` æ¥å£ç¡®ä¿ä¸€è‡´çš„å“åº”æ ¼å¼
2. **é”™è¯¯å¤„ç†**ï¼šå®ç°å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶
3. **èº«ä»½éªŒè¯**ï¼šå¯¹æ•æ„Ÿæ¥å£å®æ–½JWTè®¤è¯
4. **å‚æ•°éªŒè¯**ï¼šä½¿ç”¨ä¸­é—´ä»¶éªŒè¯è¯·æ±‚å‚æ•°
5. **é€Ÿç‡é™åˆ¶**ï¼šé˜²æ­¢APIæ»¥ç”¨

**ç« èŠ‚æ¥æº**
- [src/routes/auth.ts](file://src/routes/auth.ts#L1-L62)
- [src/models/types.ts](file://src/models/types.ts#L45-L60)

## ä¸šåŠ¡é€»è¾‘æ‰©å±•

### æœåŠ¡å±‚è®¾è®¡åŸåˆ™

ä¸šåŠ¡é€»è¾‘åº”è¯¥é›†ä¸­åœ¨æœåŠ¡å±‚ï¼Œä¿æŒæ§åˆ¶å™¨çš„ç®€æ´æ€§ï¼š

```mermaid
classDiagram
class TronRPCService {
-rpcUrl : string
-timeout : number
-retryTimes : number
-pollingInterval : number
+startPolling(callback) void
+stopPolling() void
+getLatestBlock() Promise~BlockInfo~
+getBlockByNumber(number) Promise~BlockInfo~
+makeHttpRequest(endpoint, data) Promise~any~
+parseTronBlockResponse(data) BlockInfo
}
class BlockDataService {
-tronRPCService : TronRPCService
-isRunning : boolean
-lastProcessedBlock : number
+start() Promise~void~
+stop() void
+onNewBlock(blockInfo) Promise~void~
+getRealTimeStats() Promise~Stats~
+syncBlocks(fromBlock, toBlock) Promise~number~
}
class AuthService {
+generateToken(user) string
+verifyToken(token) JWTPayload
+extractTokenFromHeader(header) string
+refreshToken(oldToken) string
}
TronRPCService <|-- BlockDataService : "ä½¿ç”¨"
AuthService --> UserModel : "ä¾èµ–"
```

**å›¾è¡¨æ¥æº**
- [src/services/TronRPCService.ts](file://src/services/TronRPCService.ts#L15-L50)
- [src/services/BlockDataService.ts](file://src/services/BlockDataService.ts#L10-L30)
- [src/services/AuthService.ts](file://src/services/AuthService.ts#L10-L30)

### æ‰©å±•ä¸šåŠ¡é€»è¾‘ç¤ºä¾‹

å‡è®¾éœ€è¦æ·»åŠ ä¸€ä¸ªæ–°çš„ç»Ÿè®¡åŠŸèƒ½ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è¿›è¡Œï¼š

1. **åˆ›å»ºæœåŠ¡ç±»**ï¼š

```typescript
export class StatisticsService {
  // è·å–è‡ªå®šä¹‰ç»Ÿè®¡
  static async getCustomStatistics(): Promise<CustomStats> {
    // å®ç°ç»Ÿè®¡é€»è¾‘
  }
  
  // ç”ŸæˆæŠ¥å‘Š
  static async generateReport(type: ReportType): Promise<ReportData> {
    // å®ç°æŠ¥å‘Šç”ŸæˆåŠŸèƒ½
  }
}
```

2. **æ·»åŠ æ•°æ®æ¨¡å‹**ï¼š

```typescript
export interface CustomStats {
  totalRecords: number;
  averageValue: number;
  maxRecord: number;
  minRecord: number;
  breakdown: Record<string, number>;
}
```

3. **åˆ›å»ºè·¯ç”±**ï¼š

```typescript
router.get('/statistics', authenticateToken, async (req, res) => {
  try {
    const stats = await StatisticsService.getCustomStatistics();
    res.json({ success: true, data: stats });
  } catch (error) {
    res.status(500).json({ success: false, error: error.message });
  }
});
```

**ç« èŠ‚æ¥æº**
- [src/services/TronRPCService.ts](file://src/services/TronRPCService.ts#L80-L150)
- [src/services/BlockDataService.ts](file://src/services/BlockDataService.ts#L40-L100)

## æ•°æ®æ¨¡å‹è®¾è®¡

### æ•°æ®æ¨¡å‹å±‚æ¬¡ç»“æ„

```mermaid
erDiagram
USERS {
int id PK
varchar username UK
varchar password
timestamp created_at
timestamp updated_at
}
BLOCKS {
int id PK
bigint block_number UK
varchar block_hash
bigint timestamp
int last_digit
boolean is_odd
timestamp created_at
}
DAILY_STATS {
int id PK
date date UK
int total_blocks
int odd_count
int even_count
timestamp updated_at
}
BLOCK_POINTS {
int id PK
bigint block_number UK
varchar block_hash
bigint timestamp
int last_digit
boolean is_odd
int point_change
int cumulative_score
timestamp created_at
}
CONFIG {
int id PK
varchar key UK
text value
varchar description
timestamp updated_at
}
USERS ||--o{ BLOCK_POINTS : "generates"
BLOCKS ||--o{ DAILY_STATS : "categorizes"
BLOCKS ||--o{ BLOCK_POINTS : "provides_data_for"
```

**å›¾è¡¨æ¥æº**
- [src/database/index.ts](file://src/database/index.ts#L60-L120)
- [src/models/types.ts](file://src/models/types.ts#L1-L30)

### æ•°æ®æ¨¡å‹æ‰©å±•æŒ‡å—

å½“éœ€è¦æ·»åŠ æ–°çš„æ•°æ®å®ä½“æ—¶ï¼Œåº”éµå¾ªä»¥ä¸‹æ­¥éª¤ï¼š

1. **å®šä¹‰æ¥å£**ï¼šåœ¨ `src/models/types.ts` ä¸­å®šä¹‰æ–°çš„æ¥å£
2. **åˆ›å»ºæ¨¡å‹ç±»**ï¼šåœ¨ `src/models/` ç›®å½•ä¸‹åˆ›å»ºå¯¹åº”çš„æ¨¡å‹ç±»
3. **æ›´æ–°æ•°æ®åº“åˆå§‹åŒ–**ï¼šåœ¨ `src/database/index.ts` ä¸­æ·»åŠ è¡¨åˆ›å»ºè¯­å¥
4. **æ·»åŠ ç´¢å¼•**ï¼šä¸ºå¸¸ç”¨æŸ¥è¯¢å­—æ®µæ·»åŠ ç´¢å¼•
5. **å®ç°CRUDæ“ä½œ**ï¼šæä¾›å®Œæ•´çš„æ•°æ®æ“ä½œæ–¹æ³•

### æ•°æ®éªŒè¯å’Œè½¬æ¢

```typescript
// æ•°æ®éªŒè¯ç¤ºä¾‹
export class DataValidator {
  static validateBlockInfo(blockInfo: Partial<BlockInfo>): BlockInfo {
    if (!blockInfo.block_number) {
      throw new Error('åŒºå—å·ä¸èƒ½ä¸ºç©º');
    }
    
    if (!blockInfo.block_hash) {
      throw new Error('åŒºå—å“ˆå¸Œä¸èƒ½ä¸ºç©º');
    }
    
    return {
      block_number: blockInfo.block_number,
      block_hash: blockInfo.block_hash,
      timestamp: blockInfo.timestamp || Date.now(),
      last_digit: blockInfo.last_digit || 0,
      is_odd: blockInfo.is_odd || false
    } as BlockInfo;
  }
}
```

**ç« èŠ‚æ¥æº**
- [src/models/types.ts](file://src/models/types.ts#L1-L60)
- [src/models/UserModel.ts](file://src/models/UserModel.ts#L1-L50)

## åŒºå—é“¾ç½‘ç»œæ‰©å±•

### æ”¯æŒå¤šåŒºå—é“¾ç½‘ç»œæ¶æ„

```mermaid
flowchart TD
Start([å¼€å§‹æ·»åŠ æ–°ç½‘ç»œ]) --> DefineInterface["å®šä¹‰é€šç”¨æ¥å£"]
DefineInterface --> CreateAdapter["åˆ›å»ºç½‘ç»œé€‚é…å™¨"]
CreateAdapter --> ImplementRPC["å®ç°RPCè°ƒç”¨"]
ImplementRPC --> ParseData["è§£ææ•°æ®æ ¼å¼"]
ParseData --> ValidateData["éªŒè¯æ•°æ®å®Œæ•´æ€§"]
ValidateData --> StoreData["å­˜å‚¨æ ‡å‡†åŒ–æ•°æ®"]
StoreData --> UpdateModels["æ›´æ–°æ•°æ®æ¨¡å‹"]
UpdateModels --> TestIntegration["æµ‹è¯•é›†æˆ"]
TestIntegration --> Deploy["éƒ¨ç½²ä¸Šçº¿"]
ValidateData --> |æ•°æ®å¼‚å¸¸| HandleError["å¤„ç†é”™è¯¯"]
HandleError --> RetryLogic["é‡è¯•é€»è¾‘"]
RetryLogic --> ValidateData
```

**å›¾è¡¨æ¥æº**
- [src/services/TronRPCService.ts](file://src/services/TronRPCService.ts#L150-L200)

### æ–°åŒºå—é“¾ç½‘ç»œé›†æˆæ­¥éª¤

1. **åˆ›å»ºç½‘ç»œé€‚é…å™¨**ï¼š

```typescript
export interface BlockchainNetwork {
  getLatestBlock(): Promise<BlockInfo>;
  getBlockByNumber(number: number): Promise<BlockInfo>;
  testConnection(): Promise<boolean>;
  parseBlockData(rawData: any): BlockInfo;
}

export class EthereumNetworkAdapter implements BlockchainNetwork {
  async getLatestBlock(): Promise<BlockInfo> {
    // å®ç°ä»¥å¤ªåŠç½‘ç»œçš„RPCè°ƒç”¨
  }
  
  async getBlockByNumber(number: number): Promise<BlockInfo> {
    // å®ç°ä»¥å¤ªåŠç½‘ç»œçš„åŒºå—æŸ¥è¯¢
  }
  
  // å…¶ä»–æ–¹æ³•å®ç°...
}
```

2. **æ›´æ–°æœåŠ¡å±‚**ï¼š

```typescript
export class MultiChainService {
  private networks: Map<string, BlockchainNetwork> = new Map();
  
  registerNetwork(name: string, network: BlockchainNetwork): void {
    this.networks.set(name, network);
  }
  
  async getBlockFromAnyNetwork(networkName: string, blockNumber: number): Promise<BlockInfo> {
    const network = this.networks.get(networkName);
    if (!network) {
      throw new Error(`ç½‘ç»œ ${networkName} æœªæ³¨å†Œ`);
    }
    
    return await network.getBlockByNumber(blockNumber);
  }
}
```

3. **é…ç½®ç®¡ç†**ï¼š

```typescript
interface NetworkConfig {
  name: string;
  rpcUrl: string;
  chainId: number;
  pollingInterval: number;
  retryTimes: number;
}

const networkConfigs: NetworkConfig[] = [
  {
    name: 'tron',
    rpcUrl: process.env.TRON_RPC_URL || 'https://api.trongrid.io',
    chainId: 195,
    pollingInterval: 3000,
    retryTimes: 3
  },
  {
    name: 'ethereum',
    rpcUrl: process.env.ETH_RPC_URL || 'https://mainnet.infura.io/v3/YOUR_PROJECT_ID',
    chainId: 1,
    pollingInterval: 15000,
    retryTimes: 5
  }
];
```

**ç« èŠ‚æ¥æº**
- [src/services/TronRPCService.ts](file://src/services/TronRPCService.ts#L200-L258)

## ä»£ç è§„èŒƒä¸æœ€ä½³å®è·µ

### TypeScriptç±»å‹å®šä¹‰è§„èŒƒ

1. **æ¥å£å‘½å**ï¼šä½¿ç”¨PascalCaseï¼Œå¦‚ `BlockInfo`, `User`
2. **å±æ€§å‘½å**ï¼šä½¿ç”¨camelCaseï¼Œå¦‚ `blockNumber`, `userName`
3. **æšä¸¾ç±»å‹**ï¼šä½¿ç”¨PascalCaseï¼Œå¦‚ `TimeRange`, `ReportType`
4. **æ³›å‹çº¦æŸ**ï¼šä½¿ç”¨æœ‰æ„ä¹‰çš„ç±»å‹å‚æ•°åç§°

```typescript
// æ­£ç¡®çš„ç±»å‹å®šä¹‰ç¤ºä¾‹
export interface ApiResponse<T = any> {
  success: boolean;
  data?: T;
  message?: string;
  error?: string;
}

export type TimeRange = '1day' | '1week' | '1month';
```

### é”™è¯¯å¤„ç†æœ€ä½³å®è·µ

```typescript
// ç»Ÿä¸€é”™è¯¯å¤„ç†è£…é¥°å™¨
export function handleErrors(target: any, propertyKey: string, descriptor: PropertyDescriptor) {
  const originalMethod = descriptor.value;
  
  descriptor.value = async function (...args: any[]) {
    try {
      return await originalMethod.apply(this, args);
    } catch (error) {
      console.error(`æ–¹æ³• ${propertyKey} æ‰§è¡Œå¤±è´¥:`, error);
      
      if (error instanceof ValidationError) {
        throw new ApiError(400, 'å‚æ•°éªŒè¯å¤±è´¥', error.message);
      }
      
      if (error instanceof DatabaseError) {
        throw new ApiError(500, 'æ•°æ®åº“æ“ä½œå¤±è´¥', error.message);
      }
      
      throw new ApiError(500, 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯', error.message);
    }
  };
}
```

### ä»£ç ç»„ç»‡åŸåˆ™

1. **å•ä¸€èŒè´£**ï¼šæ¯ä¸ªæ–‡ä»¶åªè´Ÿè´£ä¸€ä¸ªç‰¹å®šçš„åŠŸèƒ½
2. **ä¾èµ–æ³¨å…¥**ï¼šä½¿ç”¨æ„é€ å‡½æ•°æ³¨å…¥ä¾èµ–ï¼Œä¾¿äºæµ‹è¯•
3. **å¼‚æ­¥ä¼˜å…ˆ**ï¼šä¼˜å…ˆä½¿ç”¨async/awaitè¯­æ³•
4. **é”™è¯¯ä¼ æ’­**ï¼šé€‚å½“çš„é”™è¯¯ä¼ æ’­å’Œå¤„ç†

```typescript
// ä¾èµ–æ³¨å…¥ç¤ºä¾‹
export class UserService {
  private userRepository: UserRepository;
  
  constructor(userRepository: UserRepository) {
    this.userRepository = userRepository;
  }
  
  async createUser(userData: CreateUserDTO): Promise<User> {
    // å®ç°ç”¨æˆ·åˆ›å»ºé€»è¾‘
  }
}
```

**ç« èŠ‚æ¥æº**
- [src/models/types.ts](file://src/models/types.ts#L45-L60)
- [src/services/AuthService.ts](file://src/services/AuthService.ts#L1-L50)

## è°ƒè¯•ä¸æµ‹è¯•

### è°ƒè¯•å·¥å…·å’ŒæŠ€å·§

ç³»ç»Ÿæä¾›äº†å¤šä¸ªè°ƒè¯•è„šæœ¬æ¥å¸®åŠ©å¼€å‘è€…ï¼š

1. **APIè°ƒè¯•**ï¼š`debug-api.js` æä¾›APIç«¯ç‚¹æµ‹è¯•
2. **æ•°æ®åº“è°ƒè¯•**ï¼š`debug-db.js` ç”¨äºæ•°æ®åº“æ“ä½œæµ‹è¯•
3. **æ—¶é—´è°ƒè¯•**ï¼š`debug-time.js` ç”¨äºæ—¶é—´ç›¸å…³åŠŸèƒ½æµ‹è¯•
4. **æ¨¡æ‹Ÿè°ƒè¯•**ï¼š`debug-api-simulate.js` æ¨¡æ‹ŸAPIå“åº”

### æµ‹è¯•æ¡†æ¶é›†æˆ

```typescript
// æµ‹è¯•ç¤ºä¾‹
describe('BlockDataService', () => {
  let service: BlockDataService;
  let mockRPC: MockTronRPCService;
  
  beforeEach(async () => {
    mockRPC = new MockTronRPCService();
    service = new BlockDataService(mockRPC);
    await service.start();
  });
  
  afterEach(async () => {
    await service.stop();
  });
  
  it('should process new blocks correctly', async () => {
    const mockBlock = {
      block_number: 1000,
      block_hash: '0x1234567890abcdef',
      timestamp: Date.now(),
      last_digit: 5,
      is_odd: true
    };
    
    // æ¨¡æ‹Ÿæ–°å—äº‹ä»¶
    await service['onNewBlock'](mockBlock);
    
    // éªŒè¯æ•°æ®è¢«æ­£ç¡®å¤„ç†
    const latestBlock = await BlockModel.getLatest();
    expect(latestBlock).toBeDefined();
    expect(latestBlock!.block_number).toBe(1000);
  });
});
```

### æ€§èƒ½ç›‘æ§

```typescript
// æ€§èƒ½ç›‘æ§è£…é¥°å™¨
export function monitorPerformance(target: any, propertyKey: string, descriptor: PropertyDescriptor) {
  const originalMethod = descriptor.value;
  
  descriptor.value = function (...args: any[]) {
    const start = Date.now();
    const result = originalMethod.apply(this, args);
    const duration = Date.now() - start;
    
    console.log(`${propertyKey} æ‰§è¡Œè€—æ—¶: ${duration}ms`);
    
    return result;
  };
}
```

**ç« èŠ‚æ¥æº**
- [README.md](file://README.md#L200-L250)

## æ•…éšœæ’é™¤æŒ‡å—

### å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

#### 1. æ•°æ®åº“è¿æ¥é—®é¢˜

**ç—‡çŠ¶**ï¼šåº”ç”¨å¯åŠ¨æ—¶å‡ºç°æ•°æ®åº“è¿æ¥é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æ£€æŸ¥æ•°æ®ç›®å½•æƒé™
ls -la data/

# ç¡®ä¿æ•°æ®ç›®å½•å­˜åœ¨
mkdir -p data/

# æ£€æŸ¥ç£ç›˜ç©ºé—´
df -h
```

#### 2. TRONç½‘ç»œè¿æ¥é—®é¢˜

**ç—‡çŠ¶**ï¼šåŒºå—æ•°æ®æ— æ³•è·å–ï¼ŒRPCè°ƒç”¨è¶…æ—¶

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æµ‹è¯•ç½‘ç»œè¿æ¥
curl -X POST https://api.trongrid.io/wallet/getnowblock \
  -H "Content-Type: application/json" \
  -d "{}"

# æ›´æ¢RPCèŠ‚ç‚¹
# ä¿®æ”¹ .env æ–‡ä»¶ä¸­çš„ TRON_RPC_URL
```

#### 3. ç«¯å£å ç”¨é—®é¢˜

**ç—‡çŠ¶**ï¼šåº”ç”¨æ— æ³•å¯åŠ¨ï¼Œæç¤ºç«¯å£å·²è¢«å ç”¨

**è§£å†³æ–¹æ¡ˆ**ï¼š
```bash
# æŸ¥æ‰¾å ç”¨ç«¯å£çš„è¿›ç¨‹
lsof -ti:3000

# æ€æ­»å ç”¨è¿›ç¨‹
kill -9 $(lsof -ti:3000)

# æˆ–ä¿®æ”¹ç«¯å£é…ç½®
echo "PORT=3001" >> .env
```

### æ—¥å¿—åˆ†æ

ç³»ç»Ÿè¿è¡Œæ—¶ä¼šè¾“å‡ºè¯¦ç»†çš„æ—¥å¿—ä¿¡æ¯ï¼Œå…³é”®æ—¥å¿—åŒ…æ‹¬ï¼š

```typescript
// å…³é”®æ—¥å¿—ç¤ºä¾‹
console.log(`ğŸ“¦ å¤„ç†æ–°åŒºå—: ${blockInfo.block_number}, å“ˆå¸Œæœ«ä½æ•°å­—: ${blockInfo.last_digit} (${blockInfo.is_odd ? 'å•' : 'åŒ'}æ•°)`);
console.log(`âœ… åŒºå— ${blockInfo.block_number} å¤„ç†å®Œæˆ`);
console.log(`ğŸ“ˆ ä»Šæ—¥ç»Ÿè®¡ç¼“å­˜å·²æ›´æ–°: æ€»è®¡${todayStats.total}, å•æ•°${todayStats.odd}, åŒæ•°${todayStats.even}`);
```

### å¥åº·æ£€æŸ¥

ç³»ç»Ÿæä¾›å¥åº·æ£€æŸ¥ç«¯ç‚¹ `/health`ï¼Œå¯ä»¥ç›‘æ§åº”ç”¨çŠ¶æ€ï¼š

```json
{
  "success": true,
  "data": {
    "status": "healthy",
    "timestamp": "2024-01-01T12:00:00.000Z",
    "uptime": 3600.5,
    "database": true,
    "rpcPolling": true
  }
}
```

**ç« èŠ‚æ¥æº**
- [src/index.ts](file://src/index.ts#L70-L85)
- [README.md](file://README.md#L250-L290)

## ç»“è®º

æœ¬å¼€å‘è€…æŒ‡å—è¯¦ç»†ä»‹ç»äº† Point-Tron é¡¹ç›®çš„æ¶æ„è®¾è®¡ã€å¼€å‘æµç¨‹å’Œæœ€ä½³å®è·µã€‚é€šè¿‡éµå¾ªè¿™äº›æŒ‡å¯¼åŸåˆ™ï¼Œå¼€å‘è€…å¯ä»¥ï¼š

1. **å¿«é€Ÿä¸Šæ‰‹**ï¼šç†è§£é¡¹ç›®ç»“æ„å’Œå¯åŠ¨æµç¨‹
2. **è§„èŒƒå¼€å‘**ï¼šéµå¾ªTypeScriptç±»å‹å®šä¹‰å’Œä»£ç è§„èŒƒ
3. **æ‰©å±•åŠŸèƒ½**ï¼šæŒ‰ç…§æ ‡å‡†æµç¨‹æ·»åŠ æ–°åŠŸèƒ½æ¨¡å—
4. **ç»´æŠ¤è´¨é‡**ï¼šä¿æŒä»£ç è´¨é‡å’Œç³»ç»Ÿç¨³å®šæ€§

é¡¹ç›®é‡‡ç”¨æ¨¡å—åŒ–è®¾è®¡ï¼Œæ”¯æŒè½»æ¾æ‰©å±•æ–°çš„åŒºå—é“¾ç½‘ç»œå’ŒåŠŸèƒ½æ¨¡å—ã€‚å»ºè®®å¼€å‘è€…åœ¨è´¡çŒ®ä»£ç å‰ä»”ç»†é˜…è¯»ç›¸å…³ç« èŠ‚ï¼Œå¹¶å‚è€ƒç°æœ‰ä»£ç å®ç°ã€‚