# Point-Tron 快速开始指南

<cite>
**本文档中引用的文件**
- [package.json](file://package.json)
- [src/index.ts](file://src/index.ts)
- [src/config/index.ts](file://src/config/index.ts)
- [src/models/UserModel.ts](file://src/models/UserModel.ts)
- [src/routes/auth.ts](file://src/routes/auth.ts)
- [README.md](file://README.md)
</cite>

## 目录
1. [项目简介](#项目简介)
2. [环境准备](#环境准备)
3. [项目安装](#项目安装)
4. [配置文件设置](#配置文件设置)
5. [项目构建与启动](#项目构建与启动)
6. [系统验证](#系统验证)
7. [默认管理员账户](#默认管理员账户)
8. [常见问题解决](#常见问题解决)
9. [总结](#总结)

## 项目简介

Point-Tron 是一个基于 TypeScript 和 Node.js 开发的波场网络区块链数据统计后台管理系统。该系统实时监控波场网络每 3 秒的出块情况，统计区块哈希最后一个阿拉伯数字的单双数规律，并提供可视化的数据分析界面。

### 核心功能
- **实时数据采集**：每 3 秒自动获取 TRON 网络最新区块数据
- **智能数据解析**：自动提取区块哈希最后数字并判断单双数
- **统计分析**：提供今日、历史数据统计和趋势分析
- **后台管理**：现代化的 Web 管理界面
- **安全认证**：JWT 令牌认证和用户权限管理

## 环境准备

在开始之前，请确保您的开发环境满足以下要求：

### Node.js 版本要求
- **最低版本**：Node.js >= 16.0.0
- **推荐版本**：Node.js >= 18.0.0（获得更好的性能和稳定性）

### npm 版本要求
- **最低版本**：npm >= 8.0.0
- **推荐版本**：npm >= 9.0.0（获得更好的包管理体验）

### 验证环境
打开终端，运行以下命令验证环境配置：

```bash
node --version
npm --version
```

如果未安装或版本不符合要求，请前往 [Node.js官网](https://nodejs.org/) 下载并安装合适的版本。

## 项目安装

### 步骤 1：克隆项目

首先，将项目克隆到本地开发环境：

```bash
git clone https://github.com/your-repository-url/point-tron.git
cd point-tron
```

### 步骤 2：安装依赖

使用 npm 安装项目所需的所有依赖包：

```bash
npm install
```

这将安装以下核心依赖：
- **Express.js**：Web 应用框架
- **SQLite3**：本地数据库存储
- **TypeScript**：类型安全的 JavaScript 超集
- **bcryptjs**：密码加密
- **jsonwebtoken**：JWT 令牌生成
- **TRON RPC API**：与波场网络交互

**执行时间**：通常需要 2-5 分钟，具体取决于网络速度

## 配置文件设置

### 创建环境配置文件

复制提供的示例配置文件：

```bash
cp .env.example .env
```

### 配置文件详解

编辑 `.env` 文件，根据您的需求修改以下配置项：

```bash
# 服务器配置
PORT=3000                    # 服务器监听端口
NODE_ENV=development         # 运行环境：development/prodution

# 数据库配置
DB_PATH=./data/point-tron.db # 数据库文件路径

# JWT 配置
JWT_SECRET=your-super-secret-jwt-key-change-in-production
JWT_EXPIRES_IN=7d            # 令牌有效期

# TRON 网络配置
TRON_RPC_URL=https://api.trongrid.io        # TRON RPC 节点
TRON_TIMEOUT=5000                           # 请求超时时间（毫秒）
TRON_RETRY_TIMES=3                          # 重试次数
TRON_POLLING_INTERVAL=3000                  # 轮询间隔（毫秒）

# 默认管理员账户
DEFAULT_ADMIN_USERNAME=admin                # 管理员用户名
DEFAULT_ADMIN_PASSWORD=admin123             # 管理员密码
```

### 关键配置说明

#### 服务器配置
- **PORT**：建议使用 3000-9000 的端口号，避免与系统其他服务冲突
- **NODE_ENV**：开发环境使用 `development`，生产环境使用 `production`

#### 数据库配置
- **DB_PATH**：数据库文件将存储在 `./data/` 目录下，确保该目录存在且有写入权限

#### TRON 网络配置
- **TRON_RPC_URL**：可以使用多个节点地址，如 `https://api.trongrid.io` 或 `https://api.shasta.trongrid.io`
- **TRON_POLLING_INTERVAL**：建议保持 3000 毫秒（3秒），这是系统的默认值

## 项目构建与启动

### 构建 TypeScript 代码

使用以下命令将 TypeScript 源代码编译为 JavaScript：

```bash
npm run build
```

**构建过程说明**：
1. TypeScript 编译器将 `.ts` 文件转换为 `.js` 文件
2. 创建 `dist/` 目录用于存放编译后的文件
3. 复制视图模板文件到 `dist/views/` 目录

### 启动开发服务器

推荐使用开发模式启动应用：

```bash
npm run dev
```

**开发模式特点**：
- 自动重启：当源代码发生变化时自动重新启动服务器
- 错误提示：提供详细的错误堆栈信息
- 热重载：提高开发效率

### 启动生产服务器

对于生产环境，使用以下命令启动：

```bash
npm start
```

**生产模式特点**：
- 直接运行编译后的 JavaScript 代码
- 更好的性能表现
- 适合部署到生产环境

## 系统验证

### 查看启动日志

启动成功后，您应该看到类似以下的日志输出：

```
🚀 Point-Tron服务器启动成功
📡 服务地址: http://localhost:3000
🔗 TRON网络: https://api.trongrid.io
⏰ 轮 Polling间隔: 3000ms
📦 处理新区块: 75729642, 哈希末位数字: 4 (双数)
✅ 区块 75729642 处理完成
```

### 访问健康检查接口

在浏览器中访问以下 URL 验证系统状态：

```
http://localhost:3000/health
```

**健康检查响应示例**：
```json
{
  "success": true,
  "data": {
    "status": "healthy",
    "timestamp": "2024-01-01T10:00:00.000Z",
    "uptime": 120.5,
    "database": true,
    "rpcPolling": true
  }
}
```

### 验证数据库连接

系统启动时会自动创建数据库文件和必要的表结构。您可以检查以下内容：

1. **数据库文件**：确认 `./data/point-tron.db` 文件存在
2. **表结构**：系统会自动创建 `users`、`blocks`、`daily_stats` 表
3. **默认管理员**：系统会自动创建默认管理员账户

## 默认管理员账户

### 登录凭据

系统启动时会自动创建默认管理员账户：

- **用户名**：`admin`
- **密码**：`admin123`

### 访问管理后台

1. 打开浏览器，访问：`http://localhost:3000/login`
2. 使用上述凭据登录
3. 登录成功后，您将被重定向到管理后台：`http://localhost:3000/admin`

### 管理后台功能

- **实时统计**：查看当前区块统计数据
- **历史数据**：浏览过去的数据记录
- **系统状态**：监控系统运行状态
- **用户管理**：管理用户账户（仅限管理员）

## 常见问题解决

### 问题 1：端口占用

**症状**：启动时出现 "Port 3000 is already in use" 错误

**解决方案**：
```bash
# 方法 1：更改端口配置
# 编辑 .env 文件，修改 PORT=3001

# 方法 2：查找并终止占用进程
lsof -ti:3000 | xargs kill -9
```

### 问题 2：数据库权限错误

**症状**：出现 "Permission denied" 或无法创建数据库文件

**解决方案**：
```bash
# 确保 data 目录存在
mkdir -p ./data

# 设置正确的权限
chmod 755 ./data
chmod 644 ./data/point-tron.db
```

### 问题 3：TRON 网络连接失败

**症状**：无法连接到 TRON RPC 节点

**解决方案**：
```bash
# 方法 1：更换 RPC 节点
# 编辑 .env 文件，修改 TRON_RPC_URL

# 可用的 TRON RPC 节点：
# 主网：https://api.trongrid.io
# 测试网：https://api.shasta.trongrid.io
# 其他节点：https://tron.nownodes.io

# 方法 2：检查网络连接
ping api.trongrid.io
```

### 问题 4：依赖安装失败

**症状**：npm install 时出现错误

**解决方案**：
```bash
# 清除缓存
npm cache clean --force

# 删除 node_modules 并重新安装
rm -rf node_modules package-lock.json
npm install

# 如果仍然失败，尝试使用淘宝镜像
npm install --registry=https://registry.npmmirror.com
```

### 问题 5：TypeScript 编译错误

**症状**：npm run build 时出现编译错误

**解决方案**：
```bash
# 检查 TypeScript 版本
npx tsc --version

# 更新 TypeScript 到最新版本
npm install typescript@latest --save-dev

# 清理并重新编译
npm run build
```

### 调试技巧

1. **启用详细日志**：
   ```bash
   DEBUG=* npm run dev
   ```

2. **检查环境变量**：
   ```bash
   echo $PORT
   echo $NODE_ENV
   ```

3. **验证配置文件**：
   ```bash
   cat .env
   ```

## 总结

通过本指南，您已经完成了 Point-Tron 项目的完整部署流程：

1. **环境准备**：确保 Node.js 和 npm 版本符合要求
2. **项目安装**：成功安装所有依赖包
3. **配置设置**：正确配置环境变量和参数
4. **项目构建**：成功编译 TypeScript 代码
5. **系统启动**：成功启动开发服务器
6. **功能验证**：验证系统各项功能正常运行

### 下一步建议

- **熟悉管理界面**：探索管理后台的各项功能
- **自定义配置**：根据实际需求调整配置参数
- **监控系统**：定期检查健康检查接口状态
- **备份数据**：定期备份数据库文件以防数据丢失

### 技术支持

如遇到任何问题，请参考项目的 [README.md](file://README.md) 文件或访问项目仓库获取更多帮助。您也可以通过以下方式寻求支持：

- **GitHub Issues**：报告 bug 和功能请求
- **邮件支持**：联系项目维护团队
- **社区论坛**：参与技术讨论和经验分享

祝您使用愉快，期待您的反馈和贡献！